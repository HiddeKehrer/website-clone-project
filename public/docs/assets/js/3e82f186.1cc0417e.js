"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[92],{3488:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>d,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"Swift/consuming_events","title":"Consuming SDK Events","description":"Consuming Events with PipeGuruDelegate","source":"@site/docs/Swift/consuming_events.md","sourceDirName":"Swift","slug":"/Swift/consuming_events","permalink":"/docs/Swift/consuming_events","draft":false,"unlisted":false,"editUrl":"https://github.com/pipeguru/documentation/tree/main/docs/Swift/consuming_events.md","tags":[{"inline":true,"label":"swift","permalink":"/docs/tags/swift"},{"inline":true,"label":"events","permalink":"/docs/tags/events"},{"inline":true,"label":"analytics","permalink":"/docs/tags/analytics"}],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Consuming SDK Events","tags":["swift","events","analytics"],"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Triggering Experiments in Swift","permalink":"/docs/Swift/triggering_experiments"},"next":{"title":"Limitations on type of pipeguru experiments","permalink":"/docs/Swift/limitations"}}');var r=t(4848),a=t(8453);const d={title:"Consuming SDK Events",tags:["swift","events","analytics"],sidebar_position:3},s=void 0,c={},l=[{value:"Consuming Events with PipeGuruDelegate",id:"consuming-events-with-pipegurudelegate",level:2},{value:"1. Conform to the Delegate",id:"1-conform-to-the-delegate",level:3},{value:"2. Set the Delegate",id:"2-set-the-delegate",level:3},{value:"3. Implement the Delegate Method",id:"3-implement-the-delegate-method",level:3},{value:"Available Events",id:"available-events",level:2},{value:"<code>experimentStarted</code>",id:"experimentstarted",level:3},{value:"<code>screenViewed</code>",id:"screenviewed",level:3},{value:"<code>transactionStarted</code>",id:"transactionstarted",level:3},{value:"<code>transactionCompleted</code>",id:"transactioncompleted",level:3},{value:"<code>transactionFailed</code>",id:"transactionfailed",level:3},{value:"<code>experimentDeliveryFailed</code>",id:"experimentdeliveryfailed",level:3},{value:"<code>experimentEnded</code>",id:"experimentended",level:3},{value:"Example: Forwarding Events to Adjust",id:"example-forwarding-events-to-adjust",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"consuming-events-with-pipegurudelegate",children:"Consuming Events with PipeGuruDelegate"}),"\n",(0,r.jsx)(n.p,{children:"PipeGuru's SDK emits a variety of events throughout the lifecycle of an experiment or feature rollout. By subscribing to these events, you can forward them to your own analytics, attribute revenue, or trigger custom in-app behavior."}),"\n",(0,r.jsxs)(n.p,{children:["The easiest way to consume these events in Swift is by using the ",(0,r.jsx)(n.code,{children:"PipeGuruDelegate"})," protocol."]}),"\n",(0,r.jsx)(n.h3,{id:"1-conform-to-the-delegate",children:"1. Conform to the Delegate"}),"\n",(0,r.jsxs)(n.p,{children:["First, make your class conform to the ",(0,r.jsx)(n.code,{children:"PipeGuruDelegate"})," protocol. This is often done in your ",(0,r.jsx)(n.code,{children:"AppDelegate"})," or a central service class."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:"import PipeGuru\n\nclass AppDelegate: UIResponder, UIApplicationDelegate, PipeGuruDelegate {\n    // MyAnalyticsService.shared.track(\n    //  event: eventInfo.event.description,\n    //  params: eventInfo.params\n    // )\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-set-the-delegate",children:"2. Set the Delegate"}),"\n",(0,r.jsxs)(n.p,{children:["In your ",(0,r.jsx)(n.code,{children:"application(_:didFinishLaunchingWithOptions:)"})," method, after initializing PipeGuru, set its delegate to ",(0,r.jsx)(n.code,{children:"self"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:'import PipeGuru\n\nclass AppDelegate: UIResponder, UIApplicationDelegate, PipeGuruDelegate {\n\n    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {\n        PipeGuru.initialize("YOUR_API_KEY")\n        PipeGuru.delegate = self // Set the delegate\n        return true\n    }\n    \n    // ... delegate methods will go here\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-implement-the-delegate-method",children:"3. Implement the Delegate Method"}),"\n",(0,r.jsxs)(n.p,{children:["The delegate protocol has one required method, ",(0,r.jsx)(n.code,{children:"pipeGuru(didFireEvent:)"}),". You can ",(0,r.jsx)(n.code,{children:"switch"})," on the ",(0,r.jsx)(n.code,{children:"PipeGuruEvent"})," enum to handle different event types. For cleaner code, we recommend using a helper function ",(0,r.jsx)(n.code,{children:"trackAnalytics"})," to forward events to your analytics platform."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:'func pipeGuru(didFireEvent event: PipeGuruEvent) {\n    switch event {\n    case .experimentStarted(let data):\n        trackAnalytics(\n            "Experiment Started",\n            properties: [\n            "pipeguru_experiment_id": data.experimentId,\n            "pipeguru_campaign_id": data.campaignId,\n            "pipeguru_variant_id": data.variantId\n            ]\n        )\n\n    case .screenViewed(let data):\n        trackAnalytics(\n            "Screen Viewed",\n            properties: [\n            "pipeguru_screen_name": data.screenName,\n            "pipeguru_screen_id": data.screenId,\n            "pipeguru_experiment_id": data.experimentId\n            ]\n        )\n\n    case .transactionStarted(let data):\n        trackAnalytics(\n            "Transaction Started",\n            properties: [\n            "product_id": data.productIdentifier,\n            "pipeguru_experiment_id": data.experimentId\n            ]\n        )\n\n    case .transactionCompleted(let data):\n        trackAnalytics(\n            "Transaction Completed",\n            properties: [\n            "product_id": data.productIdentifier,\n            "purchase_type": data.purchaseType.rawValue,\n            "transaction_id": data.transactionId,\n            "revenue": data.revenue,\n            "currency": data.currency,\n            "pipeguru_experiment_id": data.experimentId,\n            "pipeguru_campaign_id": data.campaignId\n            ]\n        )\n    \n    case .transactionFailed(let data):\n        // Logger.error("Transaction failed", error: data.error, extra: ["product_id": data.productIdentifier])\n\n    case .experimentDeliveryFailed(let data):\n        // Fired when an experiment could not be loaded (e.g. network error)\n        // and a fallback was shown.\n        // Logger.warning("Failed to deliver experiment", error: data.error, extra: ["experiment_id": data.experimentId])\n\n    case .experimentEnded(let data):\n        trackAnalytics(\n            "Experiment Ended",\n            properties: [\n            "pipeguru_experiment_id": data.experimentId,\n            "pipeguru_campaign_id": data.campaignId\n            ]\n        )\n    }\n}\n\nprivate func trackAnalytics(_ eventName: String, properties: [String: Any]) {\n    // Your analytics provider\'s tracking method goes here.\n    // e.g., Analytics.track(eventName, properties: properties)\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"available-events",children:"Available Events"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"PipeGuruEvent"})," enum provides detailed information for each stage of the user's journey through an experiment."]}),"\n",(0,r.jsx)(n.h3,{id:"experimentstarted",children:(0,r.jsx)(n.code,{children:"experimentStarted"})}),"\n",(0,r.jsx)(n.p,{children:"Fired when a user is enrolled in an experiment."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"experimentId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"campaignId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"variantId: String"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"screenviewed",children:(0,r.jsx)(n.code,{children:"screenViewed"})}),"\n",(0,r.jsx)(n.p,{children:"Fired each time a new screen within a PipeGuru flow is presented to the user. This is key for multi-step flows."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"screenName: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"screenId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"experimentId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"campaignId: String"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"transactionstarted",children:(0,r.jsx)(n.code,{children:"transactionStarted"})}),"\n",(0,r.jsx)(n.p,{children:"Fired when a transaction is initiated from an experiment screen."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"productIdentifier: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"experimentId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"campaignId: String"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"transactioncompleted",children:(0,r.jsx)(n.code,{children:"transactionCompleted"})}),"\n",(0,r.jsx)(n.p,{children:"Fired upon successful completion of a transaction."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"productIdentifier: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"purchaseType: PipeGuruPurchaseType"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"transactionId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"revenue: Double"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"currency: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"experimentId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"campaignId: String"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"transactionfailed",children:(0,r.jsx)(n.code,{children:"transactionFailed"})}),"\n",(0,r.jsx)(n.p,{children:"Fired if a transaction fails."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"error: Error"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"productIdentifier: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"experimentId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"campaignId: String"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"experimentdeliveryfailed",children:(0,r.jsx)(n.code,{children:"experimentDeliveryFailed"})}),"\n",(0,r.jsx)(n.p,{children:"Fired when an experiment could not be loaded (e.g. due to a network error) and a fallback was shown instead."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"error: Error"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"experimentId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"campaignId: String"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"experimentended",children:(0,r.jsx)(n.code,{children:"experimentEnded"})}),"\n",(0,r.jsx)(n.p,{children:"Fired when the user completes or exits the experiment flow."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"experimentId: String"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"campaignId: String"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"example-forwarding-events-to-adjust",children:"Example: Forwarding Events to Adjust"}),"\n",(0,r.jsxs)(n.p,{children:["Here\u2019s how you can forward PipeGuru events to ",(0,r.jsx)(n.a,{href:"https://adjust.com/",children:"Adjust"})," to measure campaign performance. First, ensure you have the Adjust SDK integrated."]}),"\n",(0,r.jsx)(n.p,{children:"You will need to create event tokens in your Adjust dashboard for the PipeGuru events you wish to track."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:'import Adjust\nimport PipeGuru\nimport StoreKit\n\n// In a real app, manage your tokens in a centralized, type-safe way.\nstruct AdjustEventTokens {\n    static let appStorePurchase = "YOUR_IOS_EVENT_TOKEN"       // Create in Adjust dashboard\n    static let internalServicePurchase = "YOUR_INTERNAL_TOKEN"  // Create in Adjust dashboard\n}\n\n// In your PipeGuruDelegate implementation\n@available(iOS 15.0, *) // StoreKit 2\nfunc pipeGuru(didFireEvent event: PipeGuruEvent) {\n    switch event {\n    case .transactionCompleted(let data):\n        switch data.purchaseType {\n        case .appStoreIAP:\n            guard let transaction = data.storeKit2Transaction else { return }\n            \n            // Verify-and-track in a single call (SDK v5 purchase verification)\n            // Ensure Purchase Verification is enabled in Adjust and App Store Connect credentials are set.\n            // Configure your event with revenue, currency, transactionId, and product info.\n            guard let adjEvent = ADJEvent(eventToken: AdjustEventTokens.appStorePurchase) else { return }\n            adjEvent?.setRevenue(data.revenue, currency: data.currency)\n            adjEvent?.setTransactionId(data.transactionId)\n            adjEvent?.addCallbackParameter("product_id", value: data.productIdentifier)\n            adjEvent?.addCallbackParameter("pipeguru_experiment_id", value: data.experimentId)\n\n            Adjust.verifyAndTrackAppStorePurchase(adjEvent) { result in\n                // result.verificationStatus / result.code / result.message\n            }\n\n        case .internalService:\n            // Standard revenue event for non-App Store purchases\n            let adjEvent = ADJEvent(eventToken: AdjustEventTokens.internalServicePurchase)\n            adjEvent?.setRevenue(data.revenue, currency: data.currency)\n            adjEvent?.setTransactionId(data.transactionId)\n            adjEvent?.addCallbackParameter("product_id", value: data.productIdentifier)\n            adjEvent?.addCallbackParameter("pipeguru_experiment_id", value: data.experimentId)\n            \n            Adjust.trackEvent(adjEvent)\n        }\n    \n    default:\n        // Handle other PipeGuru events or ignore them.\n        break\n    }\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>s});var i=t(6540);const r={},a=i.createContext(r);function d(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);